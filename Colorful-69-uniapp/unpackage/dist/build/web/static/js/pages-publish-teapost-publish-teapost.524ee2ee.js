(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-publish-teapost-publish-teapost"],{"22e3":function(t,e,a){"use strict";a.r(e);var i=a("d402"),o=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=o.a},"2a78":function(t,e,a){"use strict";a.r(e);var i=a("87d0"),o=a("22e3");for(var n in o)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(n);a("ec01");var s=a("828b"),c=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"19b31f65",null,!1,i["a"],void 0);e["default"]=c.exports},"87d0":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"publish-teapost-page"},[a("v-uni-view",{staticClass:"header"},[a("v-uni-view",{staticClass:"back-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goBack.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"back-icon",attrs:{src:"/static/icon/back.png"}})],1),a("v-uni-view",{staticClass:"title"},[t._v("发布茶贴")])],1),a("v-uni-view",{staticClass:"form-container"},[a("v-uni-view",{staticClass:"form-item",staticStyle:{"border-bottom":"10rpx solid #eee"}},[a("v-uni-view",{staticClass:"label"},[t._v("标茶贴题")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入茶贴标题"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-view",{staticClass:"label"},[t._v("年龄")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入年龄",type:"number"},model:{value:t.formData.age,callback:function(e){t.$set(t.formData,"age",e)},expression:"formData.age"}})],1),a("v-uni-view",{staticClass:"form-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showTypeModal.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"label"},[t._v("类型")]),a("v-uni-view",{staticClass:"input-like",class:{placeholder:!t.selectedType}},[t._v(t._s(t.selectedType||"请选择类型"))]),a("v-uni-image",{staticClass:"arrow-icon",attrs:{src:"/static/icon/arrow-right.png"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-view",{staticClass:"label"},[t._v("服务项目")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入服务项目"},model:{value:t.formData.service_project,callback:function(e){t.$set(t.formData,"service_project",e)},expression:"formData.service_project"}})],1),a("v-uni-view",{staticClass:"form-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goToAddress.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"label"},[t._v("服务地区")]),a("v-uni-view",{staticClass:"input-like",class:{placeholder:!t.selectedAddress}},[t._v(t._s(t.selectedAddress||"请选择服务地区"))]),a("v-uni-image",{staticClass:"arrow-icon",attrs:{src:"/static/icon/arrow-right.png"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-view",{staticClass:"label"},[t._v("消费情况")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"1p 500 2p 800 包夜2000"},model:{value:t.formData.consumption_situation,callback:function(e){t.$set(t.formData,"consumption_situation",e)},expression:"formData.consumption_situation"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-view",{staticClass:"label"},[t._v("是否包赔")]),a("v-uni-view",{staticClass:"switch-container"},[a("v-uni-switch",{attrs:{color:"#fd264c"},model:{value:t.formData.is_gpc,callback:function(e){t.$set(t.formData,"is_gpc",e)},expression:"formData.is_gpc"}})],1)],1),a("v-uni-view",{staticClass:"form-items"},[a("v-uni-view",{staticClass:"labels"},[t._v("详细描述")]),a("v-uni-textarea",{staticClass:"textarea",attrs:{placeholder:"请输入详细描述"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),a("v-uni-view",{staticClass:"form-items"},[a("v-uni-view",{staticClass:"labels"},[t._v("上传视频")]),a("v-uni-view",{staticClass:"video-tip m-b-20"},[t._v("(上传个人的真实视频)")]),a("v-uni-view",{staticClass:"video-upload"},[a("v-uni-view",{staticClass:"video-list"},[t.formData.video?a("v-uni-view",{staticClass:"video-item"},[a("v-uni-video",{staticClass:"uploaded-video",attrs:{src:t.getVideoUrl(t.formData.video),controls:!0}}),a("v-uni-view",{staticClass:"delete-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteVideo.apply(void 0,arguments)}}},[t._v("×")])],1):t._e(),t.formData.video?t._e():a("v-uni-view",{staticClass:"add-video-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseVideo.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"add-icon",attrs:{src:"/static/home/ic_photo_add.png"}})],1)],1)],1)],1),a("v-uni-view",{staticClass:"form-items "},[a("v-uni-view",{staticClass:"labels "},[t._v("上传图片")]),a("v-uni-view",{staticClass:"image-tip m-b-20"},[t._v("(最多上传9张图片)")]),a("v-uni-view",{staticClass:"image-upload"},[a("v-uni-view",{staticClass:"image-list"},[t._l(t.formData.image,(function(e,i){return a("v-uni-view",{key:i,staticClass:"image-item"},[a("v-uni-image",{staticClass:"uploaded-image",attrs:{src:t.getImageUrl(e),mode:"aspectFill"}}),a("v-uni-view",{staticClass:"delete-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteImage(i)}}},[t._v("×")])],1)})),t.formData.image.length<9?a("v-uni-view",{staticClass:"add-image-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseImage.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"add-icon",attrs:{src:"/static/home/ic_photo_add.png"}})],1):t._e()],2)],1)],1)],1),a("v-uni-view",{staticClass:"bottom-actions"},[a("v-uni-button",{staticClass:"submit-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitTeapost.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"btn-text"},[t._v("立即发布")])],1)],1),t.showTypeModalFlag?a("v-uni-view",{staticClass:"modal-overlay",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideTypeModal.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[a("v-uni-view",{staticClass:"modal-header"},[a("v-uni-text",{staticClass:"modal-title"},[t._v("选择类型")]),a("v-uni-text",{staticClass:"modal-close",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideTypeModal.apply(void 0,arguments)}}},[t._v("×")])],1),a("v-uni-view",{staticClass:"modal-body"},t._l(t.typeList,(function(e){return a("v-uni-view",{key:e.id,staticClass:"type-item",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.selectType(e)}}},[a("v-uni-text",{staticClass:"type-name"},[t._v(t._s(e.name))])],1)})),1)],1)],1):t._e()],1)},o=[]},"9b0d":function(t,e,a){var i=a("c86c");e=i(!1),e.push([t.i,".publish-teapost-page[data-v-19b31f65]{min-height:100vh;background-color:#fff}\n\n/* 头部样式 */.header[data-v-19b31f65]{position:fixed;top:0;left:0;right:0;height:%?88?%;background-color:#fff;display:flex;align-items:center;justify-content:center;z-index:999;border-bottom:%?1?% solid #eee}.back-btn[data-v-19b31f65]{position:absolute;left:%?30?%;width:%?60?%;height:%?60?%;display:flex;align-items:center;justify-content:center}.back-icon[data-v-19b31f65]{width:%?40?%;height:%?40?%}.title[data-v-19b31f65]{font-size:%?36?%;color:#333}\n\n/* 表单样式 */.form-container[data-v-19b31f65]{padding:%?120?% %?0?% %?30?%;background-color:#fff;min-height:100vh}.form-item[data-v-19b31f65]{display:flex;align-items:center;background-color:#fff;padding:%?30?% %?40?%;position:relative}.label[data-v-19b31f65]{width:%?200?%;font-size:%?32?%;color:#333;font-weight:500;flex-shrink:0}.form-items[data-v-19b31f65]{display:flex;flex-direction:column;background-color:#fff;padding:%?30?% %?40?%;position:relative}.labels[data-v-19b31f65]{width:%?200?%;font-size:%?32?%;color:#333;font-weight:500;flex-shrink:0}.input[data-v-19b31f65]{flex:1;font-size:%?32?%;color:#333;padding-left:%?20?%;text-align:right;border:none;background:transparent}.input-like[data-v-19b31f65]{flex:1;font-size:%?32?%;color:#333;padding:%?20?% 0 %?20?% %?20?%;text-align:right}.input-like.placeholder[data-v-19b31f65]{color:#999}.arrow-icon[data-v-19b31f65]{width:%?30?%;height:%?30?%;margin-left:%?20?%}.textarea[data-v-19b31f65]{flex:1;font-size:%?30?%;color:#999;width:%?650?%;margin-top:%?10?%;padding:%?15?%;min-height:%?200?%;background-color:#eee;border:none;border-radius:%?8?%}.switch-container[data-v-19b31f65]{flex:1;display:flex;align-items:center;justify-content:flex-end}.switch-text[data-v-19b31f65]{font-size:%?32?%;color:#333}\n\n/* 图片上传样式 */.image-upload[data-v-19b31f65]{flex:1;padding-left:%?20?%}.image-list[data-v-19b31f65]{display:flex;flex-wrap:wrap;gap:%?20?%}.image-item[data-v-19b31f65]{position:relative;width:%?150?%;height:%?150?%}.uploaded-image[data-v-19b31f65]{width:100%;height:100%;border-radius:%?12?%}.delete-btn[data-v-19b31f65]{position:absolute;top:%?-10?%;right:%?-10?%;width:%?40?%;height:%?40?%;background-color:#ff4757;color:#fff;border-radius:50%;display:flex;align-items:center;z-index:9;justify-content:center;font-size:%?24?%}.add-image-btn[data-v-19b31f65]{width:%?150?%;height:%?150?%;border-radius:%?12?%;display:flex;flex-direction:column;align-items:center;justify-content:center}.add-icon[data-v-19b31f65]{width:100%;height:100%;margin-bottom:%?10?%}.add-text[data-v-19b31f65]{font-size:%?24?%;color:#999}.image-tip[data-v-19b31f65]{font-size:%?24?%;color:#fd1f57;margin-top:%?10?%}\n\n/* 视频上传样式 */.video-upload[data-v-19b31f65]{flex:1;padding-left:%?20?%}.video-list[data-v-19b31f65]{display:flex;flex-wrap:wrap;gap:%?20?%}.video-item[data-v-19b31f65]{position:relative;width:%?300?%;height:%?200?%}.uploaded-video[data-v-19b31f65]{width:100%;height:100%;border-radius:%?12?%}.add-video-btn[data-v-19b31f65]{width:%?150?%;height:%?150?%;border-radius:%?12?%;display:flex;flex-direction:column;align-items:center;justify-content:center}.video-tip[data-v-19b31f65]{font-size:%?24?%;color:#fd264c;margin-top:%?10?%}\n\n/* 底部按钮 */.bottom-actions[data-v-19b31f65]{background-color:#fff;padding:%?30?% %?40?%}.submit-btn[data-v-19b31f65]{width:%?600?%;height:%?88?%;background:#fd264c;border-radius:%?20?%;display:flex;align-items:center;justify-content:center;border:none}.submit-btn[data-v-19b31f65]:disabled{background-color:#ccc}.btn-text[data-v-19b31f65]{font-size:%?32?%;color:#fff;font-weight:700}\n\n/* 弹窗样式 */.modal-overlay[data-v-19b31f65]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.5);z-index:1000;display:flex;align-items:center;justify-content:center}.modal-content[data-v-19b31f65]{width:%?600?%;max-height:80vh;background-color:#fff;border-radius:%?20?%;overflow:hidden}.modal-header[data-v-19b31f65]{display:flex;align-items:center;justify-content:space-between;padding:%?30?%;border-bottom:%?1?% solid #eee}.modal-title[data-v-19b31f65]{font-size:%?36?%;color:#333;font-weight:500}.modal-close[data-v-19b31f65]{font-size:%?40?%;color:#999}.modal-body[data-v-19b31f65]{max-height:60vh;overflow-y:auto}.type-item[data-v-19b31f65]{padding:%?30?%;border-bottom:%?1?% solid #f5f5f5}.type-item[data-v-19b31f65]:last-child{border-bottom:none}.type-name[data-v-19b31f65]{font-size:%?32?%;color:#333}",""]),t.exports=e},a8e6:function(t,e,a){var i=a("9b0d");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=a("967d").default;o("207824d8",i,!0,{sourceMap:!1,shadowMode:!1})},d402:function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(a("2634")),n=i(a("2fdc"));a("e966"),a("aa9c"),a("bf0f"),a("dd2b"),a("9db6"),a("01a2"),a("e39c");var s={data:function(){return{formData:{title:"",age:"",type:0,service_project:"",province_id:"",city_id:"",area_id:"",consumption_situation:"",description:"",is_gpc:!1,image:[],video:""},typeList:[],showTypeModalFlag:!1,selectedType:"",selectedAddress:"",videoUploadUrl:""}},onLoad:function(){this.getTypeList(),this.getBasicInfo()},onShow:function(){var t=uni.getStorageSync("teapostAuthSelectedAddress");t&&(this.formData.province_id=t.province_id,this.formData.city_id=t.city_id,this.formData.area_id=t.area_id,this.selectedAddress=t.fullAddress,uni.removeStorageSync("teapostAuthSelectedAddress"))},methods:{goBack:function(){uni.navigateBack()},getBasicInfo:function(){var t=this;uni.request({url:getApp().globalData.baseUrl+"api/basicinfo",method:"GET",success:function(e){200===e.data.code?t.videoUploadUrl=e.data.data.video_url:uni.showToast({title:e.data.msg||"获取基础信息失败",icon:"none"})},fail:function(){uni.showToast({title:"网络错误",icon:"none"})}})},getTypeList:function(){var t=this,e=getApp().getCache("userInfo");if(e&&e.token){var a={token:e.token};getApp().getData("api/loufeng/type",a,(function(e){200==e.code&&e.data&&(t.typeList=e.data)}))}},showTypeModal:function(){this.showTypeModalFlag=!0},hideTypeModal:function(){this.showTypeModalFlag=!1},selectType:function(t){this.formData.type=parseInt(t.id),this.selectedType=t.name,this.hideTypeModal()},goToAddress:function(){uni.navigateTo({url:"/pages/auth-address/auth-address?from=teapostAuth&level=0"})},chooseImage:function(){var t=this;uni.chooseImage({count:9-this.formData.image.length,sizeType:["compressed"],sourceType:["album","camera"],success:function(){var e=(0,n.default)((0,o.default)().mark((function e(a){var i,n,s;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<a.tempFilePaths.length)){e.next=20;break}return e.prev=2,uni.showLoading({title:"上传图片中..."}),e.next=6,t.uploadImage(a.tempFilePaths[i]);case 6:n=e.sent,s=n.url||n,t.formData.image.push(s),uni.hideLoading(),e.next=17;break;case 12:return e.prev=12,e.t0=e["catch"](2),uni.hideLoading(),uni.showToast({title:e.t0||"图片上传失败",icon:"none"}),e.abrupt("break",20);case 17:i++,e.next=1;break;case 20:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}()})},chooseVideo:function(){var t=this;uni.chooseVideo({sourceType:["album","camera"],maxDuration:60,camera:"back",success:function(){var e=(0,n.default)((0,o.default)().mark((function e(a){var i,n;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,uni.showLoading({title:"上传视频中..."}),e.next=4,t.uploadVideo(a.tempFilePath);case 4:i=e.sent,n=i.url||i,t.formData.video=n,uni.hideLoading(),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](0),uni.hideLoading(),uni.showToast({title:e.t0||"视频上传失败",icon:"none"});case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()})},uploadImage:function(t){return new Promise((function(e,a){var i=getApp().getCache("userInfo");uni.uploadFile({url:"http://103.43.71.158/api/upload/image",filePath:t,name:"image",header:{token:i.token},success:function(t){try{var i=JSON.parse(t.data);200===i.code?e(i.data):a(i.msg||"上传失败")}catch(o){a("上传失败")}},fail:function(t){a("上传失败")}})}))},uploadVideo:function(t){var e=this;return new Promise((function(a,i){var o=getApp().getCache("userInfo");e.videoUploadUrl?uni.uploadFile({url:e.videoUploadUrl+"/api/upload/video",filePath:t,name:"video",header:{token:o.token},success:function(t){try{var e=JSON.parse(t.data);200===e.code?a(e.data):i(e.msg||"上传失败")}catch(o){i("上传失败")}},fail:function(t){i("上传失败")}}):i("视频上传地址未获取")}))},deleteImage:function(t){this.formData.image.splice(t,1)},deleteVideo:function(){this.formData.video=""},getImageUrl:function(t){return t.startsWith("http")?t:"http://103.43.71.158"+t},getVideoUrl:function(t){return t.startsWith("http")?t:"http://103.43.71.158"+t},createOrder:function(t){var e=this,a=getApp().getCache("userInfo"),i={token:a.token,type:"loufeng_auth",info_id:t};getApp().getData("api/order/create",i,(function(t){200==t.code?e.processPayment(t.data):console.log("创建订单失败:",t.msg)}))},processPayment:function(t){var e=getApp().getCache("userInfo"),a={token:e.token,id:t,paytype:0,type:"loufeng_auth"};getApp().getData("api/order/pay",a,(function(t){200==t.code?console.log("支付接口调用成功"):console.log("支付接口调用失败:",t.msg)}))},submitTeapost:function(){if(this.formData.title)if(this.formData.age)if(this.formData.type)if(this.formData.service_project)if(this.formData.province_id&&this.formData.city_id&&this.formData.area_id)if(this.formData.consumption_situation)if(this.formData.description)if(0!==this.formData.image.length)if(this.formData.video){var t={title:this.formData.title,age:parseInt(this.formData.age),type:parseInt(this.formData.type),service_project:this.formData.service_project,province_id:parseInt(this.formData.province_id),city_id:parseInt(this.formData.city_id),area_id:parseInt(this.formData.area_id),consumption_situation:this.formData.consumption_situation,description:this.formData.description,is_gpc:this.formData.is_gpc?1:0,image:this.formData.image.join(","),video:this.formData.video};getApp().getData("api/loufeng/data/publish",t,(function(t){200==t.code?uni.showToast({title:"发布成功",icon:"success"}):uni.showToast({title:t.msg||"发布失败",icon:"none"})}))}else uni.showToast({title:"请上传视频",icon:"none"});else uni.showToast({title:"请上传至少一张图片",icon:"none"});else uni.showToast({title:"请输入详细描述",icon:"none"});else uni.showToast({title:"请输入消费情况",icon:"none"});else uni.showToast({title:"请选择服务地区",icon:"none"});else uni.showToast({title:"请输入服务项目",icon:"none"});else uni.showToast({title:"请选择类型",icon:"none"});else uni.showToast({title:"请输入年龄",icon:"none"});else uni.showToast({title:"请输入标题",icon:"none"})}}};e.default=s},ec01:function(t,e,a){"use strict";var i=a("a8e6"),o=a.n(i);o.a}}]);