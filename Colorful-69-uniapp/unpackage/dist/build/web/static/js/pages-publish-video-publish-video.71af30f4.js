(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-publish-video-publish-video"],{"403e":function(t,e,a){var i=a("7674");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("967d").default;n("043c556a",i,!0,{sourceMap:!1,shadowMode:!1})},"46ef":function(t,e,a){"use strict";var i=a("403e"),n=a.n(i);n.a},5376:function(t,e,a){"use strict";a.r(e);var i=a("b3d1"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},7674:function(t,e,a){var i=a("c86c");e=i(!1),e.push([t.i,".publish-page[data-v-2c11208e]{background-color:#fff;min-height:100vh}\n\n/* 自定义导航栏 */.custom-navbar[data-v-2c11208e]{position:fixed;top:0;left:0;right:0;z-index:1000;background-color:#fafafa;padding-top:0}.navbar-content[data-v-2c11208e]{height:%?88?%;display:flex;align-items:center;justify-content:space-between;padding:0 %?30?%}.nav-left[data-v-2c11208e], .nav-right[data-v-2c11208e]{width:%?80?%;height:%?60?%;display:flex;align-items:center;justify-content:center}.back-icon[data-v-2c11208e]{width:%?40?%;height:%?40?%}.nav-center[data-v-2c11208e]{flex:1;display:flex;align-items:center;justify-content:center}.nav-title[data-v-2c11208e]{color:#000;font-size:%?36?%}\n\n/* 内容区域 */.content-container[data-v-2c11208e]{padding-top:calc(0px + %?88?%);padding:calc(0px + %?88?%) %?30?% %?30?%}\n\n/* 上传区域 */.upload-section[data-v-2c11208e]{margin-bottom:%?40?%}.upload-row[data-v-2c11208e]{display:flex;gap:%?20?%;margin:%?40?% auto}.upload-item[data-v-2c11208e]{flex:1}.section-title[data-v-2c11208e]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?10?%;display:block}.red-title[data-v-2c11208e]{color:#fd2e41}.title-row[data-v-2c11208e]{display:flex;align-items:center;margin-bottom:%?20?%}.title-tip[data-v-2c11208e]{font-size:%?24?%;color:#999;flex-shrink:0;margin-left:%?20?%}.upload-tip[data-v-2c11208e]{font-size:%?24?%;color:#999;margin-bottom:%?20?%;display:block}.video-upload-area[data-v-2c11208e]{height:%?300?%;border:%?2?% dashed #ddd;border-radius:%?20?%;display:flex;align-items:center;justify-content:center;background-color:#eee}.cover-upload-area[data-v-2c11208e]{height:%?300?%;border:%?2?% dashed #ddd;border-radius:%?20?%;display:flex;align-items:center;justify-content:center;background-color:#eee}.upload-placeholder[data-v-2c11208e]{display:flex;flex-direction:column;align-items:center;justify-content:center}.upload-icon[data-v-2c11208e]{width:%?80?%;height:%?80?%;margin-bottom:%?20?%;opacity:.6}.upload-text[data-v-2c11208e]{font-size:%?28?%;color:#666;margin-bottom:%?10?%}.upload-tip[data-v-2c11208e]{font-size:%?24?%;color:#999}.preview-video[data-v-2c11208e]{width:100%;height:100%;border-radius:%?20?%}.preview-cover[data-v-2c11208e]{width:100%;height:100%;border-radius:%?20?%}\n\n/* 输入区域 */.input-section[data-v-2c11208e]{margin-bottom:%?40?%;position:relative}.title-input[data-v-2c11208e]{width:100%;height:%?80?%;background-color:#eee;border-radius:%?20?%;padding:0 %?30?%;font-size:%?28?%;color:#333;border:%?2?% solid #eee}.char-count[data-v-2c11208e]{position:absolute;right:%?30?%;top:%?80?%;font-size:%?24?%;color:#999;margin-top:%?10?%}.price-input-container[data-v-2c11208e]{display:flex;align-items:center;background-color:#eee;border-radius:%?20?%;padding:0 %?30?%;height:%?80?%;border:%?2?% solid #eee}.currency-symbol[data-v-2c11208e]{font-size:%?32?%;color:#333;margin-right:%?10?%;font-weight:700}.price-input[data-v-2c11208e]{flex:1;height:100%;font-size:%?28?%;color:#333}\n\n/* 标签区域 */.tag-section[data-v-2c11208e]{margin-bottom:%?60?%}.tag-container[data-v-2c11208e]{display:flex;flex-wrap:wrap;gap:%?20?%}.tag-item[data-v-2c11208e]{padding:%?15?% %?30?%;border-radius:%?40?%;background-color:#fff;border:%?2?% solid #eee;transition:all .3s ease}.tag-item.active[data-v-2c11208e]{background:linear-gradient(180deg,#fd2e41 0,#fc1071)}.tag-text[data-v-2c11208e]{font-size:%?26?%;color:#666}.tag-item.active .tag-text[data-v-2c11208e]{color:#fff}\n\n/* 规则说明 */.rules-section[data-v-2c11208e]{margin-bottom:%?40?%;padding:%?30?%;border-radius:%?20?%}.rules-text[data-v-2c11208e]{font-size:%?28?%;color:#333;line-height:1.8;margin-bottom:%?15?%;display:block;font-weight:700;text-align:left}\n\n/* 提交按钮 */.submit-section[data-v-2c11208e]{margin-top:%?60?%}.submit-btn[data-v-2c11208e]{height:%?100?%;background:linear-gradient(180deg,#fd2e41 0,#fc1071);border-radius:%?20?%;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.submit-btn[data-v-2c11208e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.submit-btn.disabled[data-v-2c11208e]{background:#ccc;box-shadow:none}.submit-text[data-v-2c11208e]{color:#fff;font-size:%?32?%;font-weight:700}\n\n/* 标签输入框 */.tag-input[data-v-2c11208e]{width:100%;height:%?80?%;background-color:#eee;border-radius:%?20?%;padding:0 %?30?%;font-size:%?28?%;color:#333;border:%?2?% solid #eee;cursor:pointer}\n\n/* 标签选择弹窗 */.tag-popup[data-v-2c11208e]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.5);z-index:2000;display:flex;align-items:flex-end;justify-content:center}.tag-popup-content[data-v-2c11208e]{width:100%;max-height:80vh;background-color:#fff;border-radius:%?40?% %?40?% 0 0;padding:%?40?% %?30?% %?60?%;-webkit-animation:slideUp-data-v-2c11208e .3s ease-out;animation:slideUp-data-v-2c11208e .3s ease-out}@-webkit-keyframes slideUp-data-v-2c11208e{from{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes slideUp-data-v-2c11208e{from{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translateY(0);transform:translateY(0)}}.popup-header[data-v-2c11208e]{text-align:center;margin-bottom:%?40?%;border-bottom:%?2?% solid #f0f0f0;padding-bottom:%?30?%;position:relative}.popup-close[data-v-2c11208e]{position:absolute;top:%?-10?%;right:0;width:%?60?%;height:%?60?%;display:flex;align-items:center;justify-content:center;cursor:pointer}.popup-close-text[data-v-2c11208e]{font-size:%?48?%;color:#999;font-weight:700;line-height:1}.popup-title[data-v-2c11208e]{font-size:%?36?%;font-weight:700;color:#333;display:block;margin-bottom:%?10?%}.popup-subtitle[data-v-2c11208e]{font-size:%?26?%;color:#999;display:block}.popup-tags[data-v-2c11208e]{display:flex;flex-wrap:wrap;gap:%?20?%;margin-bottom:%?60?%;max-height:%?400?%;overflow-y:auto}.popup-tag-item[data-v-2c11208e]{padding:%?20?% %?40?%;border-radius:%?40?%;background-color:#f8f8f8;border:%?2?% solid #eee;transition:all .3s ease}.popup-tag-item.active[data-v-2c11208e]{background:linear-gradient(180deg,#fd2e41 0,#fc1071);-webkit-transform:scale(1.05);transform:scale(1.05)}.popup-tag-text[data-v-2c11208e]{font-size:%?28?%;color:#666}.popup-tag-item.active .popup-tag-text[data-v-2c11208e]{color:#fff}.popup-actions[data-v-2c11208e]{display:flex}.popup-btn[data-v-2c11208e]{flex:1;height:%?80?%;border-radius:%?40?%;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.popup-btn.confirm[data-v-2c11208e]{background:linear-gradient(180deg,#fd2e41 0,#fc1071)}.popup-btn.confirm.disabled[data-v-2c11208e]{background:#ccc;box-shadow:none;cursor:not-allowed;opacity:.6}.popup-btn[data-v-2c11208e]:active{-webkit-transform:scale(.95);transform:scale(.95)}.popup-btn-text[data-v-2c11208e]{font-size:%?30?%;font-weight:700}.popup-btn.confirm .popup-btn-text[data-v-2c11208e]{color:#fff}.popup-btn.confirm.disabled .popup-btn-text[data-v-2c11208e]{color:#999}",""]),t.exports=e},ae8c:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"publish-page"},[a("v-uni-view",{staticClass:"custom-navbar"},[a("v-uni-view",{staticClass:"navbar-content"},[a("v-uni-view",{staticClass:"nav-left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goBack.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"back-icon",attrs:{src:"/static/home/ic_common_back.png",mode:"aspectFit"}})],1),a("v-uni-view",{staticClass:"nav-center"},[a("v-uni-text",{staticClass:"nav-title"},[t._v("发布动态")])],1),a("v-uni-view",{staticClass:"nav-right"})],1)],1),a("v-uni-view",{staticClass:"content-container"},[a("v-uni-view",{staticClass:"upload-row"},[a("v-uni-view",{staticClass:"upload-item"},[a("v-uni-view",{staticClass:"video-upload-area",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectVideo.apply(void 0,arguments)}}},[t.videoPath?a("v-uni-video",{staticClass:"preview-video",attrs:{src:t.videoPath,controls:!0}}):a("v-uni-view",{staticClass:"upload-placeholder"},[a("v-uni-image",{staticClass:"upload-icon",attrs:{src:"/static/home/ic_add_video.png",mode:"aspectFit"}}),a("v-uni-text",{staticClass:"upload-text"},[t._v("添加视频")])],1)],1)],1),a("v-uni-view",{staticClass:"upload-item"},[a("v-uni-view",{staticClass:"cover-upload-area",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectCover.apply(void 0,arguments)}}},[t.coverPath?a("v-uni-image",{staticClass:"preview-cover",attrs:{src:t.coverPath,mode:"aspectFill"}}):a("v-uni-view",{staticClass:"upload-placeholder"},[a("v-uni-image",{staticClass:"upload-icon",attrs:{src:"/static/home/ic_photo_add.png",mode:"aspectFit"}}),a("v-uni-text",{staticClass:"upload-text"},[t._v("添加视频封面")])],1)],1)],1)],1),a("v-uni-view",{staticClass:"input-section"},[a("v-uni-view",{staticClass:"title-row"},[a("v-uni-text",{staticClass:"section-title red-title"},[t._v("视频标题")]),a("v-uni-text",{staticClass:"title-tip"},[t._v("好的标题可提升视频点击率")])],1),a("v-uni-input",{staticClass:"title-input",attrs:{placeholder:"请输入视频标题",maxlength:"100"},model:{value:t.videoTitle,callback:function(e){t.videoTitle=e},expression:"videoTitle"}})],1),a("v-uni-view",{staticClass:"input-section"},[a("v-uni-view",{staticClass:"title-row"},[a("v-uni-text",{staticClass:"section-title red-title"},[t._v("设定价格")]),a("v-uni-text",{staticClass:"title-tip"},[t._v("原创主最高设置5元，UP主最高设置2元。")])],1),a("v-uni-view",{staticClass:"price-input-container"},[a("v-uni-input",{staticClass:"price-input",attrs:{placeholder:"设置观看价格，不输则为免费",type:"digit"},model:{value:t.videoPrice,callback:function(e){t.videoPrice=e},expression:"videoPrice"}})],1)],1),a("v-uni-view",{staticClass:"input-section"},[a("v-uni-view",{staticClass:"title-row"},[a("v-uni-text",{staticClass:"section-title red-title"},[t._v("视频标签")]),a("v-uni-text",{staticClass:"title-tip"},[t._v("设置符合视频内容的标签。")])],1),a("v-uni-input",{staticClass:"tag-input",attrs:{placeholder:"请选择视频标签",readonly:!0},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showTagSelector.apply(void 0,arguments)}},model:{value:t.selectedTagsText,callback:function(e){t.selectedTagsText=e},expression:"selectedTagsText"}})],1),a("v-uni-view",{staticClass:"rules-section"},[a("v-uni-text",{staticClass:"rules-text"},[t._v("1、视频内无其他平台网址及水印")]),a("v-uni-text",{staticClass:"rules-text"},[t._v("2、视频清晰，封面于内容一致")]),a("v-uni-text",{staticClass:"rules-text"},[t._v("3、真实原创收视率偏高")]),a("v-uni-text",{staticClass:"rules-text"},[t._v("4、单片付费观看返佣发布者70%")])],1),a("v-uni-view",{staticClass:"submit-section"},[a("v-uni-view",{staticClass:"submit-btn",class:{disabled:t.uploading},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.publishVideo.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"submit-text"},[t._v(t._s(t.uploading?"上传中...":"上传视频"))])],1)],1)],1),t.showTagPopup?a("v-uni-view",{staticClass:"tag-popup",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideTagSelector.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"tag-popup-content",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[a("v-uni-view",{staticClass:"popup-header"},[a("v-uni-view",{staticClass:"popup-close",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideTagSelector.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"popup-close-text"},[t._v("×")])],1),a("v-uni-text",{staticClass:"popup-title"},[t._v("选择视频标签")]),a("v-uni-text",{staticClass:"popup-subtitle"},[t._v("最多选择3个标签")])],1),a("v-uni-view",{staticClass:"popup-tags"},t._l(t.availableTags,(function(e,i){return a("v-uni-view",{key:e.id,staticClass:"popup-tag-item",class:{active:t.selectedTagIds.includes(e.id)},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.toggleTag(e)}}},[a("v-uni-text",{staticClass:"popup-tag-text"},[t._v(t._s(e.name))])],1)})),1),a("v-uni-view",{staticClass:"popup-actions"},[a("v-uni-view",{staticClass:"popup-btn confirm",class:{disabled:0===t.selectedTagIds.length},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.confirmTagSelection.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"popup-btn-text"},[t._v("确定")])],1)],1)],1)],1):t._e()],1)},n=[]},b3d1:function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("5ef2"),a("dd2b"),a("aa9c"),a("fd3c"),a("8f71"),a("bf0f"),a("4626"),a("5ac7"),a("0c26"),a("e838");var n=i(a("2634")),o=i(a("2fdc")),s={data:function(){return{videoPath:"",coverPath:"",videoTitle:"",videoPrice:"",selectedTagIds:[],selectedTagsText:"",availableTags:[],showTagPopup:!1,uploading:!1,videoUrl:"",coverUrl:"",videoUploadUrl:""}},onLoad:function(){this.getBasicInfo()},methods:{goBack:function(){uni.navigateBack()},getBasicInfo:function(){var t=this;uni.request({url:getApp().globalData.baseUrl+"api/basicinfo",method:"GET",success:function(e){200===e.data.code?t.videoUploadUrl=e.data.data.video_url:uni.showToast({title:e.data.msg||"获取基础信息失败",icon:"none"})},fail:function(){uni.showToast({title:"网络错误",icon:"none"})}})},selectVideo:function(){var t=this;uni.chooseVideo({sourceType:["camera","album"],maxDuration:300,success:function(){var e=(0,o.default)((0,n.default)().mark((function e(a){var i;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=a.size,!(i>524288e4)){e.next=4;break}return uni.showToast({title:"视频大小不能超过5G",icon:"none"}),e.abrupt("return");case 4:return t.videoPath=a.tempFilePath,e.prev=5,uni.showLoading({title:"上传视频中..."}),e.next=9,t.uploadVideo(t.videoPath);case 9:t.videoUrl=e.sent,uni.hideLoading(),uni.showToast({title:"视频上传成功",icon:"success"}),e.next=20;break;case 14:e.prev=14,e.t0=e["catch"](5),uni.hideLoading(),uni.showToast({title:e.t0||"视频上传失败",icon:"none"}),t.videoPath="",t.videoUrl="";case 20:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}()})},selectCover:function(){var t=this;uni.chooseImage({count:1,sourceType:["camera","album"],success:function(){var e=(0,o.default)((0,n.default)().mark((function e(a){return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.coverPath=a.tempFilePaths[0],e.prev=1,uni.showLoading({title:"上传封面中..."}),e.next=5,t.uploadImage(t.coverPath);case 5:t.coverUrl=e.sent,uni.hideLoading(),uni.showToast({title:"封面上传成功",icon:"success"}),e.next=16;break;case 10:e.prev=10,e.t0=e["catch"](1),uni.hideLoading(),uni.showToast({title:e.t0||"封面上传失败",icon:"none"}),t.coverPath="",t.coverUrl="";case 16:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()})},getTagList:function(){var t=this,e=getApp().getCache("userInfo");e&&e.token?uni.request({url:getApp().globalData.baseUrl+"api/video/member/label/list",method:"POST",header:{token:e.token},data:{name:""},success:function(e){200===e.data.code?t.availableTags=e.data.data||[]:(uni.showToast({title:e.data.msg||"获取标签列表失败",icon:"none"}),t.availableTags=[{id:1,name:"搞笑"},{id:2,name:"美食"},{id:3,name:"旅行"}])},fail:function(e){console.error("获取标签列表失败:",e),uni.showToast({title:"网络错误，请重试",icon:"none"}),t.availableTags=[{id:1,name:"搞笑"},{id:2,name:"美食"},{id:3,name:"旅行"}]}}):uni.showToast({title:"请先登录",icon:"none"})},showTagSelector:function(){this.selectedTagIds=[],this.showTagPopup=!0,this.getTagList()},hideTagSelector:function(){this.showTagPopup=!1},toggleTag:function(t){var e=this.selectedTagIds.indexOf(t.id);e>-1?this.selectedTagIds.splice(e,1):this.selectedTagIds.length<3?this.selectedTagIds.push(t.id):uni.showToast({title:"最多选择3个标签",icon:"none"})},confirmTagSelection:function(){var t=this;if(0!==this.selectedTagIds.length){var e=this.availableTags.filter((function(e){return t.selectedTagIds.includes(e.id)})).map((function(t){return t.name}));this.selectedTagsText=e.join(", "),this.hideTagSelector()}else uni.showToast({title:"请至少选择一个标签",icon:"none"})},uploadImage:function(t){return new Promise((function(e,a){var i=getApp().getCache("userInfo");uni.uploadFile({url:"http://103.43.71.158/api/upload/image",filePath:t,name:"image",header:{token:i.token},success:function(t){var i=JSON.parse(t.data);200===i.code?e(i.data):a(i.msg||"上传失败")},fail:function(){a("网络错误")}})}))},uploadVideo:function(t){var e=this;return new Promise((function(a,i){var n=getApp().getCache("userInfo");e.videoUploadUrl?uni.uploadFile({url:e.videoUploadUrl+"/api/upload/video",filePath:t,name:"video",header:{token:n.token},success:function(t){var e=JSON.parse(t.data);200===e.code?a(e.data):i(e.msg||"上传失败")},fail:function(){i("网络错误")}}):i("视频上传地址未获取")}))},publishVideo:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.uploading){e.next=2;break}return e.abrupt("return");case 2:if(t.videoUrl){e.next=5;break}return uni.showToast({title:"请先选择并上传视频",icon:"none"}),e.abrupt("return");case 5:if(t.coverUrl){e.next=8;break}return uni.showToast({title:"请先选择并上传封面",icon:"none"}),e.abrupt("return");case 8:if(t.videoTitle.trim()){e.next=11;break}return uni.showToast({title:"请输入视频标题",icon:"none"}),e.abrupt("return");case 11:if(!(t.videoPrice&&parseFloat(t.videoPrice)<=0)){e.next=14;break}return uni.showToast({title:"价格必须大于0，不输入则为免费",icon:"none"}),e.abrupt("return");case 14:return t.uploading=!0,e.prev=15,uni.showLoading({title:"发布中..."}),e.next=19,t.submitVideo();case 19:uni.hideLoading(),setTimeout((function(){uni.navigateBack()}),1500),e.next=27;break;case 23:e.prev=23,e.t0=e["catch"](15),uni.hideLoading(),uni.showToast({title:e.t0||"发布失败",icon:"none"});case 27:return e.prev=27,t.uploading=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[15,23,27,30]])})))()},submitVideo:function(){var t=this;return new Promise((function(e,a){var i=getApp().getCache("userInfo"),n=t.selectedTagIds.join(",");uni.request({url:getApp().globalData.baseUrl+"api/video/member/add",method:"POST",header:{token:i.token},data:{name:t.videoTitle,url:t.videoUrl,cover:t.coverUrl,amount:parseFloat(t.videoPrice)||0,scope:1,video_label_ids:n},success:function(t){200===t.data.code?(uni.showToast({title:t.data.msg,icon:"success"}),e(t.data)):a(t.data.msg||"发布失败")},fail:function(){a("网络错误")}})}))}}};e.default=s},c7f4:function(t,e,a){"use strict";a.r(e);var i=a("ae8c"),n=a("5376");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("46ef");var s=a("828b"),c=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"2c11208e",null,!1,i["a"],void 0);e["default"]=c.exports}}]);